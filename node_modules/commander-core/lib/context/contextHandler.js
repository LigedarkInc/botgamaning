'use strict'

async function contextHandler(context, bot) {
	const startTime = Date.now();

	let command = bot.commander.find(context);
	
	if(!command) {
		return bot.listener.emit('command_not_found', context, bot)
	}

	bot.command = command;

	try {
		await Promise.all([
			bot.listener.emit('command_job', context, bot),
			command.handler(context, bot)
		])
	} catch (error) {
		return bot.listener.emit('command_error', context, bot, error);
	}

	const endTime = Date.now();
	bot.ping = endTime-startTime;

	bot.listener.emit('command_ready', context, bot);
}

module.exports = contextHandler